# Roadmap проекту Proxmox LXC CRI

## Структура гілок розробки
- `main` - основна гілка, стабільна версія
- `feature/refactor-runtime` - оптимізація та рефакторинг CRI/OCI реалізації
- `feature/oci-runtime-completion` - завершення OCI-сумісного runtime
- `feature/proxmox-api-extended` - розширення функціональності Proxmox API
- `feature/container-hooks` - реалізація системи хуків для контейнерів

## Поточний етап: POC (Proof of Concept)
Тривалість: 4 тижні
Прогрес: 80%
Витрачено часу: 124 годин
Очікуваний час до завершення: ~24 години

### Мета
Продемонструвати можливість інтеграції Proxmox LXC з Kubernetes через CRI та реалізувати базовий OCI-сумісний runtime.

### Очікуваний результат
- Базова реалізація CRI для комунікації з Kubernetes ✓
- Інтеграція з Proxmox API для управління LXC контейнерами ✓
- Відповідність специфікації OCI для контейнерів ✓
- Успішний запуск LXC контейнера як Pod через CRI-O (в процесі, 90%)

### Виконані завдання
1. Налаштування базової структури проекту ✓ (16 годин)
   - Ініціалізація Zig проекту ✓
   - Налаштування середовища розробки ✓
   - Конфігурація системи збірки ✓
   - Налаштування CI/CD ✓
2. Реалізація базових операцій з контейнерами ✓ (24 години)
   - Створення ✓
   - Видалення ✓
   - Запуск ✓
   - Зупинка ✓
   - Отримання статусу ✓
3. Реалізація gRPC сервера для CRI ✓ (20 годин)
4. Реалізація тестів для основних операцій ✓ (12 годин)
   - Тести базових операцій з контейнерами ✓
   - Тести gRPC взаємодії ✓
   - Тести обробки помилок ✓
5. Реалізація OCI-сумісного runtime ✓ (16 годин)
   - Створення специфікації контейнера ✓
   - Реалізація структур даних для OCI специфікації ✓
   - Реалізація білдера для створення специфікацій ✓
   - Тести для OCI специфікацій та білдера ✓
   - Реалізація структури Container та ContainerState ✓
   - Тести для Container та ContainerState ✓
6. Інтеграція з Proxmox API ✓ (8 годин)
   - Базова реалізація клієнта ✓
   - Автентифікація та авторизація ✓
   - Базові операції з LXC ✓
   - Обробка помилок ✓
7. Оптимізація збірки та залежностей ✓ (16 годин)
   - Виправлення конфліктів з бібліотеками ✓
   - Налаштування правильних шляхів до бібліотек ✓
   - Оптимізація системи збірки ✓
   - Покращення обробки помилок ✓
8. Реалізація системи хуків ✓ (12 годин) [feature/container-hooks]
   - Створення базового менеджера хуків ✓ (3 години)
   - Реалізація prestart, poststart, poststop хуків ✓ (4 години)
   - Реалізація передачі контексту в хуки ✓ (2 години)
   - Обробка помилок та таймаутів ✓ (2 години)
   - Безпечне управління ресурсами ✓ (1 година)

### Поточні завдання (Залишилось ~24 години)
1. Оптимізація та рефакторинг CRI/OCI реалізації (12 годин) [feature/refactor-runtime]:
   - Створення спільного інтерфейсу для CRI та OCI runtime (90% готово)
   - Об'єднання дубльованої функціональності контейнерів (90% готово)
   - Розділення відповідальності між компонентами (80% готово)
   - Створення єдиного інтерфейсу для роботи з контейнерами (70% готово)
   - Винесення Proxmox-специфічного коду в окремий модуль (60% готово)
   - Написання тестів для нової архітектури (50% готово)

2. Завершення OCI-сумісного runtime (8 годин) [feature/oci-runtime-completion]:
   - Інтеграція Container з основним рантаймом (95% готово)
   - Інтеграція з CRI-O (80% готово)
   - Реалізація хуків життєвого циклу (90% готово) ✓

3. Розширення функціональності Proxmox API клієнта (4 години) [feature/proxmox-api-extended]:
   - Розширене управління ресурсами (70% готово)
   - Покращення обробки помилок (90% готово)
   - Розширені тести (50% готово)

### План рефакторингу
1. Етап 1: Створення спільного інтерфейсу (90% готово)
   - Визначення базового інтерфейсу для runtime ✓
   - Реалізація інтерфейсу для OCI ✓
   - Реалізація інтерфейсу для CRI ✓
   - Тести для перевірки сумісності (в процесі)

2. Етап 2: Об'єднання функціональності контейнерів (90% готово)
   - Створення єдиної структури Container ✓
   - Міграція існуючого коду ✓
   - Оновлення залежних компонентів ✓
   - Тести для контейнерів ✓

3. Етап 3: Розділення відповідальності (80% готово)
   - Створення окремого Proxmox модуля ✓
   - Перенесення специфічного коду ✓
   - Створення абстракцій для платформо-залежного коду (в процесі)
   - Тести для Proxmox модуля (в процесі)

4. Етап 4: Фінальна інтеграція (80% готово)
   - Інтеграція всіх компонентів (завершено) ✓
   - Перевірка сумісності (90% готово)
   - Оптимізація продуктивності (80% готово)
   - Комплексні тести (70% готово)

### Стратегія розгортання гілок
1. Основний розвиток:
   - `main` -> стабільна версія
   - `develop` -> інтеграційна гілка для нових функцій

2. Функціональні гілки:
   - `feature/*` -> нові функції та можливості
   - `fix/*` -> виправлення помилок
   - `docs/*` -> оновлення документації

3. Релізні гілки:
   - `release/*` -> підготовка релізів
   - `hotfix/*` -> термінові виправлення в production

### Майбутні завдання
1. Управління ресурсами [feature/proxmox-api-extended]:
   - CPU та пам'ять
   - Дисковий простір
   - Мережеві ресурси
2. Мережева конфігурація:
   - Управління мережевими інтерфейсами
   - Підтримка мережевих просторів імен
   - Політики мережі
3. Управління знімками:
   - Створення та відновлення
   - Управління версіями
   - Планування
4. Міграція контейнерів:
   - Жива міграція
   - Холодна міграція
   - Валідація та відкат
5. Управління шаблонами:
   - Створення та налаштування
   - Версіонування
   - Розповсюдження

## Наступні етапи

### POV (Proof of Value)
Тривалість: 3 тижні
- Оптимізація продуктивності
- Тестування під навантаженням
- Моніторинг та логування
- Безпека та ізоляція

### MVP (Minimum Viable Product)
Тривалість: 3 тижні
- Повна документація
- Інструменти для розгортання
- Підтримка мережевих політик
- Готовність до production

## Загальний прогрес проекту
- Прогрес: 80% (збільшено з 75% завдяки завершенню системи хуків та прогресу в інтеграції)
- Витрачено часу: 124 години
- Очікуваний час до завершення POC: 24 години
- Очікуваний час до повного завершення проекту: 4.5 тижні

### Ключові досягнення останнього етапу:
1. Вирішено проблеми з конфліктами бібліотек та залежностей
2. Покращено систему збірки та оптимізовано конфігурацію
3. Значний прогрес у інтеграції CRI-O
4. Розширено тестове покриття та покращено обробку помилок
5. Реалізовано повноцінну систему хуків з підтримкою життєвого циклу контейнерів

### Ризики та виклики:
1. Можливі проблеми з продуктивністю при масштабуванні
2. Необхідність додаткового тестування безпеки та ізоляції
3. Потенційні проблеми з сумісністю при оновленні CRI-O

## Поточні проблеми та їх вирішення

### Проблеми зборки (Вирішено ✓)
1. Несумісність версій бібліотек:
   - Конфлікт між версіями protobuf та abseil ✓
   - Проблеми з макросами ABSL_ATTRIBUTE_LIFETIME_BOUND ✓
   - Помилки компіляції через версію C++ ✓

### План подальшої оптимізації
1. Покращення продуктивності:
   - [ ] Оптимізація використання пам'яті
   - [ ] Зменшення накладних витрат на GRPC комунікацію
   - [ ] Покращення паралельної обробки запитів

2. Розширення функціональності:
   - [ ] Додавання підтримки додаткових функцій Proxmox
   - [ ] Розширення можливостей конфігурації контейнерів
   - [ ] Покращення моніторингу та логування

3. Тестування та стабільність:
   - [ ] Розширення покриття інтеграційними тестами
   - [ ] Додавання тестів продуктивності
   - [ ] Покращення обробки граничних випадків
