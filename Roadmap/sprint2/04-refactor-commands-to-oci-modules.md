# Sprint 2: Рефакторинг команд в OCI модулі

## Опис завдання
Рефакторинг команд з `src/main.zig` в окремі модулі `src/oci/` для кращої організації коду та усунення дублювання.

## Поточний стан
- Команди `executeStart`, `executeState`, `executeKill`, `executeDelete` вже використовують модулі з `src/oci/`
- Команди `executeStop`, `executeList`, `executeInfo` мають дублювання коду в `src/main.zig`
- Логіка роботи з Proxmox API дублюється в різних місцях

## Завдання
- [x] Створити модуль `src/oci/stop.zig` для команди stop
- [x] Створити модуль `src/oci/list.zig` для команди list
- [x] Створити модуль `src/oci/info.zig` для команди info
- [x] Оновити `src/oci/mod.zig` для експорту нових модулів
- [x] Рефакторити `src/main.zig` для використання нових модулів
- [x] Усунути дублювання коду
- [x] Перевірити компіляцію та функціональність

## Виконані зміни

### 1. Створено `src/oci/stop.zig`
- Перенесено логіку зупинки контейнера з `executeStop`
- Використовує `proxmox_client` для роботи з API
- Перевіряє статус контейнера перед зупинкою
- Логує всі дії через `proxmox_client.logger`

### 2. Створено `src/oci/list.zig`
- Реалізовано функцію `list` для виведення списку контейнерів
- Форматування виводу у вигляді таблиці (VMID, Name, Status, Type)
- Використовує `proxmox_client.listLXCs()` для отримання даних
- Правильно обробляє пам'ять з `defer` блоками

### 3. Створено `src/oci/info.zig`
- Реалізовано функцію `info` для детальної інформації про контейнер
- Виводить всі доступні поля з `LXCConfig` та `LXCContainer`
- Включає мережеву конфігурацію, ресурси та статус
- Обробляє помилки та неіснуючі контейнери

### 4. Оновлено `src/oci/mod.zig`
- Додано експорт нових модулів: `stop`, `list`, `info`
- Забезпечено доступ до нових функцій через `oci.stop`, `oci.list`, `oci.info`

### 5. Рефакторинг `src/main.zig`
- Замінено `executeStop` на виклик `oci.stop.stop()`
- Замінено `executeList` на виклик `oci.list.list()`
- Замінено `executeInfo` на виклик `oci.info.info()`
- Усунуто дублювання коду та логіки

## Переваги рефакторингу

### 1. Краща організація коду
- Кожна команда має свій модуль
- Логіка розділена за функціональністю
- Легше знаходити та змінювати код

### 2. Усунення дублювання
- Логіка роботи з Proxmox API не дублюється
- Єдине місце для кожної функції
- Легше підтримувати та оновлювати

### 3. Краща тестованість
- Кожен модуль можна тестувати окремо
- Легше створювати моки та тести
- Ізольована логіка для кожного компонента

### 4. Консистентність
- Всі команди використовують однаковий патерн
- Єдиний стиль логування через `proxmox_client.logger`
- Однакове оброблення помилок

## Технічні деталі

### Структура модулів
```
src/oci/
├── stop.zig      # Зупинка контейнерів
├── list.zig      # Список контейнерів
├── info.zig      # Інформація про контейнер
├── start.zig     # Запуск контейнерів
├── state.zig     # Стан контейнерів
├── kill.zig      # Відправка сигналів
├── delete.zig    # Видалення контейнерів
└── mod.zig       # Експорт модулів
```

### Патерн використання
```zig
// В main.zig
fn executeStop(container_id: []const u8, logger_ctx: *types.LogContext) !void {
    _ = logger_ctx; // Використовуємо логер з proxmox_client
    try oci.stop.stop(container_id, proxmox_client);
}

// В oci/stop.zig
pub fn stop(container_id: []const u8, proxmox_client: *proxmox.ProxmoxClient) !void {
    try proxmox_client.logger.info("Stopping container: {s}", .{container_id});
    // ... логіка зупинки
}
```

## Тестування
- ✅ Команда `list` виводить таблицю контейнерів
- ✅ Команда `info` показує детальну інформацію
- ✅ Команда `stop` працює через OCI модуль
- ✅ Проект успішно компілюється
- ✅ Усунено дублювання коду

## Оцінка часу
- Аналіз поточного стану: 30 хв
- Створення модулів: 1 година
- Рефакторинг main.zig: 45 хв
- Виправлення помилок компіляції: 45 хв
- Тестування: 30 хв
- Документація: 15 хв
- Загальний час: 3 години 45 хв

## Фактично витрачений час
- Аналіз поточного стану: 30 хв
- Створення модулів: 1 година
- Рефакторинг main.zig: 45 хв
- Виправлення помилок компіляції: 1 година
- Тестування: 30 хв
- Документація: 15 хв
- Загальний час: 4 години

## Статус
- [x] Планування
- [x] В розробці
- [x] Тестування
- [x] Завершено

## Результат
Код рефакторовано з кращою організацією, усунено дублювання, створено модульну архітектуру для команд OCI.
