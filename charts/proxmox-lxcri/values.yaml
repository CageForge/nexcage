# Default values for Proxmox LXCRI Helm Chart
# This file contains comprehensive configuration options for production deployment

# ============================================================================
# GLOBAL CONFIGURATION
# ============================================================================
global:
  # Image registry settings
  imageRegistry: ghcr.io
  imagePullSecrets: []
  
  # Cluster-wide settings
  clusterDomain: cluster.local
  storageClass: ""
  
  # Security context for all containers
  securityContext:
    runAsNonRoot: true
    runAsUser: 65534
    fsGroup: 65534
    seccompProfile:
      type: RuntimeDefault
  
  # Network policy settings
  networkPolicy:
    enabled: true
    defaultDeny: true

# ============================================================================
# IMAGE CONFIGURATION
# ============================================================================
image:
  registry: ghcr.io
  repository: kubebsd/proxmox-lxcri
  tag: "0.3.0"
  pullPolicy: IfNotPresent
  pullSecrets: []

# Node setup image for DaemonSet
nodeSetup:
  image:
    registry: ghcr.io
    repository: kubebsd/proxmox-lxcri-node-setup
    tag: "0.3.0"
    pullPolicy: IfNotPresent

# ============================================================================
# DEPLOYMENT CONFIGURATION
# ============================================================================
deployment:
  # Deployment strategy
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  
  # Replica configuration
  replicaCount: 2
  
  # Node selection
  nodeSelector: {}
  tolerations: []
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - proxmox-lxcri
          topologyKey: kubernetes.io/hostname

# ============================================================================
# DAEMONSET CONFIGURATION (for node-level runtime installation)
# ============================================================================
daemonset:
  enabled: true
  
  # Update strategy
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
  
  # Node selection for runtime installation
  nodeSelector:
    kubernetes.io/os: linux
  
  tolerations:
  - operator: Exists
    effect: NoSchedule
  - operator: Exists
    effect: NoExecute

# ============================================================================
# SERVICE CONFIGURATION
# ============================================================================
service:
  type: ClusterIP
  port: 8080
  targetPort: 8080
  annotations: {}
  
  # Additional ports for monitoring, debugging, etc.
  additionalPorts:
  - name: metrics
    port: 9090
    targetPort: 9090
    protocol: TCP
  - name: health
    port: 8081
    targetPort: 8081
    protocol: TCP

# ============================================================================
# INGRESS CONFIGURATION
# ============================================================================
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # cert-manager.io/cluster-issuer: letsencrypt-prod
  
  hosts:
  - host: proxmox-lxcri.local
    paths:
    - path: /
      pathType: Prefix
  
  tls: []
  #  - secretName: proxmox-lxcri-tls
  #    hosts:
  #      - proxmox-lxcri.local

# ============================================================================
# RUNTIME CLASS CONFIGURATION
# ============================================================================
runtimeClass:
  # Create RuntimeClass resource
  enabled: true
  
  # Runtime classes to create
  classes:
  - name: proxmox-lxcri
    handler: proxmox-lxcri
    overhead:
      podFixed:
        memory: 64Mi
        cpu: 100m
    scheduling:
      nodeClassificationPolicy: ""
      tolerations: []
  
  - name: proxmox-lxcri-secure
    handler: proxmox-lxcri
    overhead:
      podFixed:
        memory: 128Mi
        cpu: 200m
    scheduling:
      nodeClassificationPolicy: RestrictedTopologyPolicy
      tolerations:
      - effect: NoSchedule
        key: proxmox-lxcri/secure
        operator: Equal
        value: "true"

# ============================================================================
# PROXMOX LXCRI CONFIGURATION
# ============================================================================
config:
  # Runtime configuration
  runtime:
    primary: crun
    fallback: runc
    dataDir: /var/lib/proxmox-lxcri
    socketPath: /run/proxmox-lxcri/runtime.sock
    
  # Proxmox VE integration
  proxmox:
    enabled: false
    host: ""
    user: ""
    passwordSecret: ""
    verifySSL: true
    timeout: 30s
  
  # Logging configuration
  logging:
    level: info
    format: json
    file: /var/log/proxmox-lxcri/runtime.log
    maxSize: 100MB
    maxAge: 30
    maxBackups: 10
    compress: true
  
  # Security configuration
  security:
    defaultProfile: secure
    auditLogging: true
    complianceStandards:
    - cis-docker
    - nist-800-190
    vulnerabilityScanning: true
  
  # Performance configuration
  performance:
    monitoring: true
    metricsInterval: 30s
    enableProfiling: false
    maxConcurrentOperations: 100
  
  # Network configuration
  network:
    enableIPv6: false
    defaultBridge: cni0
    mtu: 1500
    pluginDir: /opt/cni/bin
    configDir: /etc/cni/net.d

# ============================================================================
# RESOURCE MANAGEMENT
# ============================================================================
resources:
  # Resource limits and requests for main container
  limits:
    cpu: 2000m
    memory: 2Gi
  requests:
    cpu: 500m
    memory: 512Mi

# Node setup DaemonSet resources
nodeSetupResources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# ============================================================================
# STORAGE CONFIGURATION
# ============================================================================
persistence:
  # Enable persistent storage
  enabled: true
  
  # Storage class
  storageClass: ""
  
  # Access mode
  accessMode: ReadWriteOnce
  
  # Storage size
  size: 10Gi
  
  # Additional volumes
  additionalVolumes: []
  additionalVolumeMounts: []

# ============================================================================
# SECURITY CONFIGURATION
# ============================================================================
security:
  # Pod security context
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 65534
    runAsGroup: 65534
    fsGroup: 65534
    seccompProfile:
      type: RuntimeDefault
  
  # Container security context
  securityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    runAsNonRoot: true
    runAsUser: 65534
    capabilities:
      drop:
      - ALL
      add:
      - NET_BIND_SERVICE
  
  # Network policies
  networkPolicy:
    enabled: true
    policyTypes:
    - Ingress
    - Egress
    ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: kube-system
      ports:
      - protocol: TCP
        port: 8080
    egress:
    - to: []
      ports:
      - protocol: TCP
        port: 53
      - protocol: UDP
        port: 53
  
  # Pod Security Standards
  podSecurityStandards:
    enforce: restricted
    audit: restricted
    warn: restricted
  
  # Certificate management
  certManager:
    enabled: false
    issuer: letsencrypt-prod

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================
monitoring:
  # Enable monitoring
  enabled: true
  
  # Prometheus integration
  prometheus:
    enabled: true
    port: 9090
    path: /metrics
    interval: 30s
    
    # ServiceMonitor for Prometheus Operator
    serviceMonitor:
      enabled: true
      namespace: ""
      labels: {}
      annotations: {}
  
  # Grafana dashboards
  grafana:
    enabled: true
    dashboards:
      enabled: true
      label: grafana_dashboard
      namespace: ""
  
  # Alerting rules
  alerting:
    enabled: true
    rules:
      enabled: true
      namespace: ""

# ============================================================================
# AUTOSCALING CONFIGURATION
# ============================================================================
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80
  
  # Behavior configuration for HPA v2
  behavior:
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 10
        periodSeconds: 60
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60

# ============================================================================
# SERVICE ACCOUNT CONFIGURATION
# ============================================================================
serviceAccount:
  # Create service account
  create: true
  
  # Service account name
  name: ""
  
  # Annotations
  annotations: {}
  
  # Automount service account token
  automountServiceAccountToken: false

# RBAC configuration
rbac:
  create: true
  rules:
  - apiGroups: [""]
    resources: ["nodes", "pods"]
    verbs: ["get", "list", "watch"]
  - apiGroups: [""]
    resources: ["events"]
    verbs: ["create", "patch"]
  - apiGroups: ["metrics.k8s.io"]
    resources: ["nodes", "pods"]
    verbs: ["get", "list"]

# ============================================================================
# TESTING CONFIGURATION
# ============================================================================
tests:
  enabled: true
  image:
    registry: ghcr.io
    repository: kubebsd/proxmox-lxcri-test
    tag: "0.3.0"
    pullPolicy: IfNotPresent

# ============================================================================
# ADVANCED CONFIGURATION
# ============================================================================
advanced:
  # Custom environment variables
  env: []
  
  # Init containers
  initContainers: []
  
  # Sidecar containers
  sidecars: []
  
  # Custom configuration files
  configFiles: {}
  
  # Priority class
  priorityClassName: ""
  
  # DNS configuration
  dnsPolicy: ClusterFirst
  dnsConfig: {}
  
  # Host networking
  hostNetwork: false
  
  # Host PID
  hostPID: false
  
  # Share process namespace
  shareProcessNamespace: false

# ============================================================================
# DEVELOPMENT AND DEBUGGING
# ============================================================================
development:
  enabled: false
  
  # Debug mode
  debug:
    enabled: false
    logLevel: trace
    enableProfiling: true
  
  # Development tools
  tools:
    enabled: false
    image:
      registry: ghcr.io
      repository: kubebsd/proxmox-lxcri-dev-tools
      tag: "0.3.0"

# ============================================================================
# BACKUP AND DISASTER RECOVERY
# ============================================================================
backup:
  enabled: false
  
  # Backup schedule
  schedule: "0 2 * * *"
  
  # Retention policy
  retention:
    days: 30
    weeks: 4
    months: 12
  
  # Storage configuration
  storage:
    provider: s3
    config: {}

# ============================================================================
# COMPLIANCE AND AUDITING
# ============================================================================
compliance:
  # Enable compliance monitoring
  enabled: false
  
  # Compliance standards
  standards:
  - pci-dss
  - hipaa
  - sox
  
  # Audit logging
  audit:
    enabled: true
    webhook:
      enabled: false
      url: ""
    file:
      enabled: true
      path: /var/log/audit/audit.log
      maxSize: 100MB
      maxAge: 90
      rotate: true

# ============================================================================
# EXTERNAL INTEGRATIONS
# ============================================================================
integrations:
  # Service mesh
  serviceMesh:
    istio:
      enabled: false
      injection: enabled
    linkerd:
      enabled: false
      injection: enabled
  
  # Observability
  observability:
    jaeger:
      enabled: false
      endpoint: ""
    opentelemetry:
      enabled: false
      endpoint: ""
  
  # Security scanning
  security:
    falco:
      enabled: false
    trivy:
      enabled: false
    twistlock:
      enabled: false
