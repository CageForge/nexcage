@startuml

!theme plain
skinparam backgroundColor transparent
skinparam componentStyle rectangle

title Proxmox LXCRI Architecture

' Actors and external systems
actor "User" as user
component "containerd" as containerd
component "Proxmox API" as proxmox
database "ZFS Storage" as zfs
component "LXC/QEMU" as runtime

' Main components
package "proxmox-lxcri" {
    component "OCI Runtime" as oci {
        component "State Manager" as state
        component "Hook System" as hooks
        component "Bundle Validator" as validator
    }
    
    component "Storage Manager" as storage {
        component "Dataset Manager" as dataset
        component "Layer Manager" as layer
        component "Image Manager" as image
    }
    
    component "Network Manager" as network {
        component "VLAN Manager" as vlan
        component "Bridge Manager" as bridge
        component "IP Manager" as ip
    }
    
    component "Security Module" as security {
        component "AppArmor/SELinux" as lsm
        component "Seccomp" as seccomp
        component "Capabilities" as caps
    }
}

' Relationships
user --> containerd : commands
containerd --> oci : OCI spec
oci --> storage : manage storage
oci --> network : configure network
oci --> security : enforce security
storage --> zfs : manage datasets
network --> proxmox : configure networking
security --> runtime : apply profiles
proxmox --> runtime : manage containers/VMs
storage ..> proxmox : storage operations

' Command flow
note right of oci
  Commands:
  - create
  - start
  - state
  - kill
  - delete
end note

' State management
note right of state
  State files:
  /run/proxmox-lxcri/
    containers/<id>/
      - state.json
      - config.json
end note

@enduml 