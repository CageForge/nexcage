
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Next-generation container runtime for Proxmox VE using LXC and OCI backends">
      
      
      
        <link rel="canonical" href="https://cageforge.github.io/nexcage/v0.7.3/testing/testing/">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.23">
    
    
      
        <title>Testing Documentation - NexCage Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#testing-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NexCage Docs" class="md-header__button md-logo" aria-label="NexCage Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NexCage Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Testing Documentation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CageForge/nexcage" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CageForge/nexcage
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Overview

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../versions.md" class="md-tabs__link">
        
  
  
    
  
  Versions

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../INSTALL/" class="md-tabs__link">
          
  
  
  Getting Started

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../user_guide/" class="md-tabs__link">
        
  
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../architecture/OVERVIEW/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../CI_CD_SETUP/" class="md-tabs__link">
        
  
  
    
  
  CI/CD

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../DEPENDENCIES/" class="md-tabs__link">
        
  
  
    
  
  Dependencies

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../PROXMOX_TESTING.md" class="md-tabs__link">
        
  
  
    
  
  Proxmox Testing

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NexCage Docs" class="md-nav__button md-logo" aria-label="NexCage Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NexCage Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CageForge/nexcage" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    CageForge/nexcage
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../versions.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Versions
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Install
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DEV_QUICKSTART/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dev Quickstart
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DEVELOPMENT_WORKFLOW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Development Workflow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DEVELOPMENT_UBUNTU/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ubuntu Dev Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user_guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../architecture/OVERVIEW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../CI_CD_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    CI/CD
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../DEPENDENCIES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependencies
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../PROXMOX_TESTING.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Proxmox Testing
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Test Structure
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Test Categories
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Categories">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-unit-tests" class="md-nav__link">
    <span class="md-ellipsis">
      1. Unit Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-performance-tests" class="md-nav__link">
    <span class="md-ellipsis">
      2. Performance Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-memory-tests" class="md-nav__link">
    <span class="md-ellipsis">
      3. Memory Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-integration-tests" class="md-nav__link">
    <span class="md-ellipsis">
      4. Integration Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-comprehensive-tests" class="md-nav__link">
    <span class="md-ellipsis">
      5. Comprehensive Tests
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Running Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Running Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#basic-test-commands" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Test Commands
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Test Commands">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-all-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Run All Tests
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-specific-test-categories" class="md-nav__link">
    <span class="md-ellipsis">
      Run Specific Test Categories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-individual-test-files" class="md-nav__link">
    <span class="md-ellipsis">
      Run Individual Test Files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-environment-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Test Environment Setup
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Environment Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#temporary-directories" class="md-nav__link">
    <span class="md-ellipsis">
      Temporary Directories
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-components" class="md-nav__link">
    <span class="md-ellipsis">
      Test Components
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Components">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layer-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Layer Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Layer Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-layer-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Layer Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-validation" class="md-nav__link">
    <span class="md-ellipsis">
      Layer Validation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layerfs-testing" class="md-nav__link">
    <span class="md-ellipsis">
      LayerFS Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayerFS Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layer-management" class="md-nav__link">
    <span class="md-ellipsis">
      Layer Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#layerfs-performance" class="md-nav__link">
    <span class="md-ellipsis">
      LayerFS Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Cache Performance
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-leak-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Leak Detection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-testing" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Testing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Integration Testing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#end-to-end-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      End-to-End Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Test Utilities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Utilities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#helper-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Helper Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Helper Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-test-digest" class="md-nav__link">
    <span class="md-ellipsis">
      Create Test Digest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-test-layer" class="md-nav__link">
    <span class="md-ellipsis">
      Create Test Layer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-mock-image-structure" class="md-nav__link">
    <span class="md-ellipsis">
      Create Mock Image Structure
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Test Configuration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Test Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-system-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Build System Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-dependencies" class="md-nav__link">
    <span class="md-ellipsis">
      Test Dependencies
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-design" class="md-nav__link">
    <span class="md-ellipsis">
      Test Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-testing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-testing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#integration-testing_1" class="md-nav__link">
    <span class="md-ellipsis">
      Integration Testing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      Troubleshooting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Troubleshooting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Common Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Common Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-failures" class="md-nav__link">
    <span class="md-ellipsis">
      Test Failures
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Issues
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Issues
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#debugging" class="md-nav__link">
    <span class="md-ellipsis">
      Debugging
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Debugging">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verbose-output" class="md-nav__link">
    <span class="md-ellipsis">
      Verbose Output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#individual-test-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Individual Test Execution
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-coverage" class="md-nav__link">
    <span class="md-ellipsis">
      Test Coverage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-enhancements" class="md-nav__link">
    <span class="md-ellipsis">
      Future Enhancements
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Future Enhancements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#planned-improvements" class="md-nav__link">
    <span class="md-ellipsis">
      Planned Improvements
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#testing-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Testing Tools
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/CageForge/nexcage/edit/master/docs/testing/testing.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="testing-documentation">Testing Documentation<a class="headerlink" href="#testing-documentation" title="Permanent link">&para;</a></h1>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>Nexcage includes a comprehensive testing suite that covers all major components of the OCI Image System. The testing framework is designed to ensure code quality, performance, and reliability across different scenarios.</p>
<h2 id="test-structure">Test Structure<a class="headerlink" href="#test-structure" title="Permanent link">&para;</a></h2>
<h3 id="test-categories">Test Categories<a class="headerlink" href="#test-categories" title="Permanent link">&para;</a></h3>
<h4 id="1-unit-tests">1. Unit Tests<a class="headerlink" href="#1-unit-tests" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Location</strong>: <code>tests/oci/image/</code></li>
<li><strong>Purpose</strong>: Test individual functions and data structures</li>
<li><strong>Coverage</strong>: Core functionality of each component</li>
<li><strong>Files</strong>:</li>
<li><code>layer_test.zig</code> - Layer management tests</li>
<li><code>layerfs_test.zig</code> - LayerFS functionality tests</li>
<li><code>config_test.zig</code> - Image configuration tests</li>
<li><code>manifest_test.zig</code> - Image manifest tests</li>
<li><code>manager_test.zig</code> - Image manager tests</li>
</ul>
<h4 id="2-performance-tests">2. Performance Tests<a class="headerlink" href="#2-performance-tests" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Location</strong>: <code>tests/performance/</code></li>
<li><strong>Purpose</strong>: Measure performance and identify bottlenecks</li>
<li><strong>Coverage</strong>: LayerFS operations, caching, parallel processing</li>
<li><strong>Files</strong>:</li>
<li><code>layerfs_performance_test.zig</code> - LayerFS performance metrics</li>
</ul>
<h4 id="3-memory-tests">3. Memory Tests<a class="headerlink" href="#3-memory-tests" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Location</strong>: <code>tests/memory/</code></li>
<li><strong>Purpose</strong>: Detect memory leaks and resource management issues</li>
<li><strong>Coverage</strong>: Memory allocation, cleanup, and resource tracking</li>
<li><strong>Files</strong>:</li>
<li><code>memory_leak_test.zig</code> - Memory leak detection</li>
</ul>
<h4 id="4-integration-tests">4. Integration Tests<a class="headerlink" href="#4-integration-tests" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Location</strong>: <code>tests/integration/</code></li>
<li><strong>Purpose</strong>: Test component interactions and end-to-end workflows</li>
<li><strong>Coverage</strong>: Complete container creation process</li>
<li><strong>Files</strong>:</li>
<li><code>end_to_end_test.zig</code> - End-to-end workflow tests</li>
</ul>
<h4 id="5-comprehensive-tests">5. Comprehensive Tests<a class="headerlink" href="#5-comprehensive-tests" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Location</strong>: <code>tests/</code></li>
<li><strong>Purpose</strong>: Combined testing of multiple components</li>
<li><strong>Coverage</strong>: Cross-component functionality</li>
<li><strong>Files</strong>:</li>
<li><code>simple_comprehensive_test.zig</code> - Simplified comprehensive tests</li>
<li><code>comprehensive_test.zig</code> - Full comprehensive test suite</li>
</ul>
<h2 id="running-tests">Running Tests<a class="headerlink" href="#running-tests" title="Permanent link">&para;</a></h2>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Zig 0.15.1 or later</li>
<li>All project dependencies installed</li>
<li>Sufficient disk space for test artifacts</li>
</ul>
<h3 id="basic-test-commands">Basic Test Commands<a class="headerlink" href="#basic-test-commands" title="Permanent link">&para;</a></h3>
<h4 id="run-all-tests">Run All Tests<a class="headerlink" href="#run-all-tests" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code>./zig-linux-x86_64-0.15.1/zig<span class="w"> </span>build<span class="w"> </span><span class="nb">test</span>
</code></pre></div>

<h4 id="run-specific-test-categories">Run Specific Test Categories<a class="headerlink" href="#run-specific-test-categories" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Performance tests</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span>build<span class="w"> </span>test-performance

<span class="c1"># Memory leak tests</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span>build<span class="w"> </span>test-memory

<span class="c1"># Integration tests</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span>build<span class="w"> </span>test-integration

<span class="c1"># Comprehensive tests</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span>build<span class="w"> </span>test-comprehensive
</code></pre></div>

<h4 id="run-individual-test-files">Run Individual Test Files<a class="headerlink" href="#run-individual-test-files" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Test specific component</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/oci/image/layerfs_test.zig

<span class="c1"># Test with specific target</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/oci/image/layerfs_test.zig<span class="w"> </span>-target<span class="w"> </span>native
</code></pre></div>

<h3 id="test-environment-setup">Test Environment Setup<a class="headerlink" href="#test-environment-setup" title="Permanent link">&para;</a></h3>
<h4 id="temporary-directories">Temporary Directories<a class="headerlink" href="#temporary-directories" title="Permanent link">&para;</a></h4>
<p>Tests create temporary directories in <code>/tmp/</code> for testing:
- <code>/tmp/test-layers-*</code> - LayerFS tests
- <code>/tmp/test-e2e-*</code> - End-to-end tests
- <code>/tmp/test-*</code> - Other component tests</p>
<h4 id="cleanup">Cleanup<a class="headerlink" href="#cleanup" title="Permanent link">&para;</a></h4>
<p>Tests automatically clean up temporary files using <code>defer</code> statements:</p>
<div class="codehilite"><pre><span></span><code><span class="kr">const</span><span class="w"> </span><span class="n">test_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/test-example&quot;</span><span class="p">;</span>
<span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">deleteTree</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span>
</code></pre></div>

<h2 id="test-components">Test Components<a class="headerlink" href="#test-components" title="Permanent link">&para;</a></h2>
<h3 id="layer-testing">Layer Testing<a class="headerlink" href="#layer-testing" title="Permanent link">&para;</a></h3>
<h4 id="basic-layer-operations">Basic Layer Operations<a class="headerlink" href="#basic-layer-operations" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;Layer creation and basic properties&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">allocator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">allocator</span><span class="p">;</span>

<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">image</span><span class="p">.</span><span class="n">createLayer</span><span class="p">(</span>
<span class="w">        </span><span class="n">allocator</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;sha256:1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="mi">1024</span><span class="p">,</span>
<span class="w">        </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Test properties</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqualStrings</span><span class="p">(</span><span class="s">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">media_type</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="nb">@as</span><span class="p">(</span><span class="kt">u64</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">),</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="layer-validation">Layer Validation<a class="headerlink" href="#layer-validation" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;Layer validation&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">createTestLayer</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Test validation</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">validate</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">validated</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">layer</span><span class="p">.</span><span class="n">last_validated</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="layerfs-testing">LayerFS Testing<a class="headerlink" href="#layerfs-testing" title="Permanent link">&para;</a></h3>
<h4 id="initialization">Initialization<a class="headerlink" href="#initialization" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;LayerFS initialization&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">layerfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">LayerFS</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/test-layers&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqualStrings</span><span class="p">(</span><span class="s">&quot;/tmp/test-layers&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">base_path</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">readonly</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="nb">@as</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">count</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="layer-management">Layer Management<a class="headerlink" href="#layer-management" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;LayerFS add and get layer&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">layerfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">LayerFS</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/tmp/test-layers&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">createTestLayer</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">retrieved_layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">getLayer</span><span class="p">(</span><span class="n">layer</span><span class="p">.</span><span class="n">digest</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">retrieved_layer</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="performance-testing">Performance Testing<a class="headerlink" href="#performance-testing" title="Permanent link">&para;</a></h3>
<h4 id="layerfs-performance">LayerFS Performance<a class="headerlink" href="#layerfs-performance" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;LayerFS performance: adding multiple layers&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">num_layers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">test_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/test-layers-performance&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">deleteTree</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">makePath</span><span class="p">(</span><span class="n">test_dir</span><span class="p">);</span>

<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">layerfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">LayerFS</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">test_dir</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">milliTimestamp</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Add multiple layers</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">..</span><span class="n">num_layers</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">createTestLayer</span><span class="p">(</span><span class="nb">@intCast</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
<span class="w">        </span><span class="k">defer</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>

<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">milliTimestamp</span><span class="p">();</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="p">;</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="nb">@as</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">num_layers</span><span class="p">),</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="n">count</span><span class="p">());</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Should complete in less than 2 seconds</span>

<span class="w">    </span><span class="n">std</span><span class="p">.</span><span class="n">debug</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;Added {d} layers in {d}ms</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="w"> </span><span class="n">num_layers</span><span class="p">,</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="cache-performance">Cache Performance<a class="headerlink" href="#cache-performance" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;MetadataCache performance&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">num_entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MetadataCache</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">num_entries</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">start_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">milliTimestamp</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Add cache entries</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">..</span><span class="n">num_entries</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">const</span><span class="w"> </span><span class="n">entry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">createTestCacheEntry</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">entry</span><span class="p">.</span><span class="n">digest</span><span class="p">,</span><span class="w"> </span><span class="n">entry</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="n">milliTimestamp</span><span class="p">();</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="p">;</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="nb">@as</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">num_entries</span><span class="p">),</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">entries</span><span class="p">.</span><span class="n">count</span><span class="p">());</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">duration</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w"> </span><span class="c1">// Should complete in less than 1 second</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="memory-testing">Memory Testing<a class="headerlink" href="#memory-testing" title="Permanent link">&para;</a></h3>
<h4 id="memory-leak-detection">Memory Leak Detection<a class="headerlink" href="#memory-leak-detection" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;Memory leak detection: LayerFS operations&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">test_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/test-memory-leak-layerfs&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">deleteTree</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">makePath</span><span class="p">(</span><span class="n">test_dir</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create and destroy LayerFS multiple times</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">..</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kr">var</span><span class="w"> </span><span class="n">layerfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">LayerFS</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="n">test_dir</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Add some layers</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">..</span><span class="mi">10</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="n">i</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kr">var</span><span class="w"> </span><span class="n">layer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">createTestLayer</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<span class="w">            </span><span class="k">defer</span><span class="w"> </span><span class="n">layer</span><span class="p">.</span><span class="n">deinit</span><span class="p">(</span><span class="n">allocator</span><span class="p">);</span>

<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="n">layerfs</span><span class="p">.</span><span class="n">addLayer</span><span class="p">(</span><span class="n">layer</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="c1">// This should clean up all resources</span>
<span class="w">        </span><span class="n">layerfs</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// If we reach here without memory issues, the test passes</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h3 id="integration-testing">Integration Testing<a class="headerlink" href="#integration-testing" title="Permanent link">&para;</a></h3>
<h4 id="end-to-end-workflow">End-to-End Workflow<a class="headerlink" href="#end-to-end-workflow" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">test</span><span class="w"> </span><span class="s">&quot;End-to-end: complete container creation workflow&quot;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">test_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/tmp/test-e2e-workflow&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">deleteTree</span><span class="p">(</span><span class="n">test_dir</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{};</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">makePath</span><span class="p">(</span><span class="n">test_dir</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create mock image structure</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">createMockImageStructure</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test-image&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;latest&quot;</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Initialize ImageManager</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">ImageManager</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;/usr/bin/umoci&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">test_dir</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">deinit</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// Verify image exists</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expectEqual</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">hasImage</span><span class="p">(</span><span class="s">&quot;test-image&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;latest&quot;</span><span class="p">));</span>

<span class="w">    </span><span class="c1">// Create container from image</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">manager</span><span class="p">.</span><span class="n">createContainerFromImage</span><span class="p">(</span><span class="s">&quot;test-image&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;latest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test-container&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">test_dir</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Verify container was created</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">container_rootfs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">_</span><span class="p">][]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">{</span><span class="w"> </span><span class="n">test_dir</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;test-container&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rootfs&quot;</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="n">free</span><span class="p">(</span><span class="n">container_rootfs</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">testing</span><span class="p">.</span><span class="n">expect</span><span class="p">(</span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">accessAbsolute</span><span class="p">(</span><span class="n">container_rootfs</span><span class="p">,</span><span class="w"> </span><span class="p">.{})</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="p">.{});</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="test-utilities">Test Utilities<a class="headerlink" href="#test-utilities" title="Permanent link">&para;</a></h2>
<h3 id="helper-functions">Helper Functions<a class="headerlink" href="#helper-functions" title="Permanent link">&para;</a></h3>
<h4 id="create-test-digest">Create Test Digest<a class="headerlink" href="#create-test-digest" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="n">createTestDigest</span><span class="p">(</span><span class="n">index</span><span class="o">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">var</span><span class="w"> </span><span class="n">buffer</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mi">128</span><span class="p">]</span><span class="kt">u8</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">undefined</span><span class="p">;</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fmt</span><span class="p">.</span><span class="n">bufPrint</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buffer</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sha256:testdigest{:0&gt;10}abcdef1234567890abcdef1234567890abcdef1234567890&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">.{</span><span class="n">index</span><span class="p">})</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="s">&quot;sha256:default&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="n">dupe</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">digest</span><span class="p">)</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="s">&quot;sha256:default&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="create-test-layer">Create Test Layer<a class="headerlink" href="#create-test-layer" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="n">createTestLayer</span><span class="p">(</span><span class="n">index</span><span class="o">:</span><span class="w"> </span><span class="kt">u32</span><span class="p">)</span><span class="w"> </span><span class="o">!*</span><span class="n">Layer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">digest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createTestDigest</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="n">free</span><span class="p">(</span><span class="n">digest</span><span class="p">);</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">Layer</span><span class="p">.</span><span class="n">createLayer</span><span class="p">(</span>
<span class="w">        </span><span class="n">allocator</span><span class="p">,</span>
<span class="w">        </span><span class="s">&quot;application/vnd.oci.image.layer.v1.tar&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="n">dupe</span><span class="p">(</span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">digest</span><span class="p">),</span>
<span class="w">        </span><span class="mi">1024</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">        </span><span class="kc">null</span>
<span class="w">    </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<h4 id="create-mock-image-structure">Create Mock Image Structure<a class="headerlink" href="#create-mock-image-structure" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="k">fn</span><span class="w"> </span><span class="n">createMockImageStructure</span><span class="p">(</span><span class="n">test_dir</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">image_name</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">image_tag</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="o">!</span><span class="kt">void</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create image directory structure</span>
<span class="w">    </span><span class="kr">const</span><span class="w"> </span><span class="n">image_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">allocator</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="n">_</span><span class="p">][]</span><span class="kr">const</span><span class="w"> </span><span class="kt">u8</span><span class="p">{</span><span class="w"> </span><span class="n">test_dir</span><span class="p">,</span><span class="w"> </span><span class="n">image_name</span><span class="p">,</span><span class="w"> </span><span class="n">image_tag</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="n">allocator</span><span class="p">.</span><span class="n">free</span><span class="p">(</span><span class="n">image_dir</span><span class="p">);</span>

<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="n">std</span><span class="p">.</span><span class="n">fs</span><span class="p">.</span><span class="n">cwd</span><span class="p">().</span><span class="n">makePath</span><span class="p">(</span><span class="n">image_dir</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Create mock files (manifest.json, config.json, layers)</span>
<span class="w">    </span><span class="c1">// ... implementation details</span>
<span class="p">}</span>
</code></pre></div>

<h2 id="test-configuration">Test Configuration<a class="headerlink" href="#test-configuration" title="Permanent link">&para;</a></h2>
<h3 id="build-system-integration">Build System Integration<a class="headerlink" href="#build-system-integration" title="Permanent link">&para;</a></h3>
<p>The testing framework is integrated with the Zig build system through <code>build.zig</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// Performance tests</span>
<span class="kr">const</span><span class="w"> </span><span class="n">performance_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">addTest</span><span class="p">(.{</span>
<span class="w">    </span><span class="p">.</span><span class="n">root_source_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;tests/performance/layerfs_performance_test.zig&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">optimize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimize</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Memory leak tests</span>
<span class="kr">const</span><span class="w"> </span><span class="n">memory_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">addTest</span><span class="p">(.{</span>
<span class="w">    </span><span class="p">.</span><span class="n">root_source_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;tests/memory/memory_leak_test.zig&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">optimize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimize</span><span class="p">,</span>
<span class="p">});</span>

<span class="c1">// Integration tests</span>
<span class="kr">const</span><span class="w"> </span><span class="n">integration_test</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">addTest</span><span class="p">(.{</span>
<span class="w">    </span><span class="p">.</span><span class="n">root_source_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="s">&quot;tests/integration/end_to_end_test.zig&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">optimize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">optimize</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div>

<h3 id="test-dependencies">Test Dependencies<a class="headerlink" href="#test-dependencies" title="Permanent link">&para;</a></h3>
<p>Tests import required modules through the build system:</p>
<div class="codehilite"><pre><span></span><code><span class="n">performance_test</span><span class="p">.</span><span class="n">root_module</span><span class="p">.</span><span class="n">addImport</span><span class="p">(</span><span class="s">&quot;types&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">types_mod</span><span class="p">);</span>
<span class="n">performance_test</span><span class="p">.</span><span class="n">root_module</span><span class="p">.</span><span class="n">addImport</span><span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error_mod</span><span class="p">);</span>
<span class="n">performance_test</span><span class="p">.</span><span class="n">root_module</span><span class="p">.</span><span class="n">addImport</span><span class="p">(</span><span class="s">&quot;logger&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">logger_mod</span><span class="p">);</span>
<span class="n">performance_test</span><span class="p">.</span><span class="n">root_module</span><span class="p">.</span><span class="n">addImport</span><span class="p">(</span><span class="s">&quot;image&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">image_mod</span><span class="p">);</span>
<span class="n">performance_test</span><span class="p">.</span><span class="n">root_module</span><span class="p">.</span><span class="n">addImport</span><span class="p">(</span><span class="s">&quot;layer&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">layer_mod</span><span class="p">);</span>
</code></pre></div>

<h2 id="best-practices">Best Practices<a class="headerlink" href="#best-practices" title="Permanent link">&para;</a></h2>
<h3 id="test-design">Test Design<a class="headerlink" href="#test-design" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Isolation</strong>: Each test should be independent and not affect others</li>
<li><strong>Cleanup</strong>: Always clean up resources using <code>defer</code> statements</li>
<li><strong>Naming</strong>: Use descriptive test names that explain the scenario</li>
<li><strong>Assertions</strong>: Use specific assertions that provide clear failure information</li>
</ol>
<h3 id="performance-testing_1">Performance Testing<a class="headerlink" href="#performance-testing_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Baseline</strong>: Establish performance baselines for comparison</li>
<li><strong>Thresholds</strong>: Set reasonable performance thresholds</li>
<li><strong>Metrics</strong>: Measure specific metrics (time, memory, throughput)</li>
<li><strong>Reproducibility</strong>: Ensure tests produce consistent results</li>
</ol>
<h3 id="memory-testing_1">Memory Testing<a class="headerlink" href="#memory-testing_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Stress Testing</strong>: Test with high load and repeated operations</li>
<li><strong>Resource Tracking</strong>: Monitor memory allocation and deallocation</li>
<li><strong>Cleanup Verification</strong>: Ensure all resources are properly cleaned up</li>
<li><strong>Leak Detection</strong>: Use tools and patterns to detect memory leaks</li>
</ol>
<h3 id="integration-testing_1">Integration Testing<a class="headerlink" href="#integration-testing_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Real Scenarios</strong>: Test realistic use cases and workflows</li>
<li><strong>Error Handling</strong>: Test error conditions and edge cases</li>
<li><strong>Component Interaction</strong>: Verify proper communication between components</li>
<li><strong>End-to-End</strong>: Test complete user workflows</li>
</ol>
<h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">&para;</a></h3>
<h4 id="test-failures">Test Failures<a class="headerlink" href="#test-failures" title="Permanent link">&para;</a></h4>
<ul>
<li>Check test environment setup</li>
<li>Verify dependencies are installed</li>
<li>Review test output for specific error messages</li>
<li>Ensure sufficient disk space and permissions</li>
</ul>
<h4 id="performance-issues">Performance Issues<a class="headerlink" href="#performance-issues" title="Permanent link">&para;</a></h4>
<ul>
<li>Monitor system resources during tests</li>
<li>Check for background processes affecting performance</li>
<li>Verify test isolation and cleanup</li>
<li>Review performance thresholds and baselines</li>
</ul>
<h4 id="memory-issues">Memory Issues<a class="headerlink" href="#memory-issues" title="Permanent link">&para;</a></h4>
<ul>
<li>Use memory profiling tools</li>
<li>Check for resource leaks in test setup</li>
<li>Verify proper cleanup in test teardown</li>
<li>Monitor system memory usage</li>
</ul>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<h4 id="verbose-output">Verbose Output<a class="headerlink" href="#verbose-output" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Enable verbose test output</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/oci/image/layerfs_test.zig<span class="w"> </span>--verbose
</code></pre></div>

<h4 id="individual-test-execution">Individual Test Execution<a class="headerlink" href="#individual-test-execution" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Run specific test by name</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/oci/image/layerfs_test.zig<span class="w"> </span>--test-filter<span class="w"> </span><span class="s2">&quot;LayerFS initialization&quot;</span>
</code></pre></div>

<h4 id="test-coverage">Test Coverage<a class="headerlink" href="#test-coverage" title="Permanent link">&para;</a></h4>
<div class="codehilite"><pre><span></span><code><span class="c1"># Generate test coverage report (if supported)</span>
./zig-linux-x86_64-0.15.1/zig<span class="w"> </span><span class="nb">test</span><span class="w"> </span>tests/oci/image/layerfs_test.zig<span class="w"> </span>--test-coverage
</code></pre></div>

<h2 id="future-enhancements">Future Enhancements<a class="headerlink" href="#future-enhancements" title="Permanent link">&para;</a></h2>
<h3 id="planned-improvements">Planned Improvements<a class="headerlink" href="#planned-improvements" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Continuous Integration</strong>: Automated test execution on code changes</li>
<li><strong>Coverage Reporting</strong>: Detailed code coverage analysis</li>
<li><strong>Performance Benchmarking</strong>: Automated performance regression detection</li>
<li><strong>Test Parallelization</strong>: Parallel test execution for faster feedback</li>
<li><strong>Mock Services</strong>: Enhanced mocking for external dependencies</li>
</ol>
<h3 id="testing-tools">Testing Tools<a class="headerlink" href="#testing-tools" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Test Runners</strong>: Specialized test execution frameworks</li>
<li><strong>Mocking Libraries</strong>: Advanced mocking and stubbing capabilities</li>
<li><strong>Performance Profilers</strong>: Detailed performance analysis tools</li>
<li><strong>Memory Analyzers</strong>: Advanced memory leak detection</li>
</ol>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>The testing framework provides comprehensive coverage of the OCI Image System components, ensuring code quality, performance, and reliability. Regular test execution helps maintain system stability and catch issues early in the development process.</p>
<p>For questions or issues with the testing framework, please refer to the project documentation or create an issue in the project repository.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
       2025 CageForge
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.expand", "content.code.copy", "content.action.edit", "content.tabs.link", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>