# CI відключено тимчасово для виправлення проблем з налаштуванням
name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      actions: read
      checks: write
      statuses: write
      security-events: write
      packages: read
      deployments: write
      pages: write
      issues: write
      discussions: write
      repository-projects: write
    steps:
      - uses: actions/checkout@v4

      - name: Run tests in Docker
        run: |
          docker run --rm -v $(pwd):/app -w /app moriarti/proxmox-lxcri-test:latest zig build test

  lint:
    name: Lint
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      actions: read
      checks: write
      statuses: write
      security-events: write
      packages: read
      deployments: write
      pages: write
      issues: write
      discussions: write
      repository-projects: write
    steps:
      - uses: actions/checkout@v4

      - name: Run lint in Docker
        run: |
          docker run --rm -v $(pwd):/app -w /app moriarti/proxmox-lxcri-test:latest zig fmt --check .

  code-scanning:
    name: Code Scanning
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      actions: read
      checks: write
      statuses: write
      security-events: write
      packages: read
      deployments: write
      pages: write
      issues: write
      discussions: write
      repository-projects: write
    steps:
      - uses: actions/checkout@v4

      - name: Run code scanning in Docker
        run: |
          docker run --rm -v $(pwd):/app -w /app moriarti/proxmox-lxcri-test:latest zig build

  secrets-scanning:
    name: Secrets Scanning
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      actions: read
      checks: write
      statuses: write
      security-events: write
      packages: read
      deployments: write
      pages: write
      issues: write
      discussions: write
      repository-projects: write
    steps:
      - uses: actions/checkout@v4

      - name: Run secrets scanning in Docker
        run: |
          docker run --rm -v $(pwd):/app -w /app moriarti/proxmox-lxcri-test:latest gitleaks detect --no-git --verbose

#   dependencies:
#     name: Dependencies
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v4

#       - name: Setup Zig
#         uses: goto-bus-stop/setup-zig@v2
#         with:
#           zig-version: '0.14.0'

#       - name: Check dependencies
#         run: zig build 