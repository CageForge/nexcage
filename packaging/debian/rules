#!/usr/bin/make -f

# Debian package build rules for nexcage
# Uses Zig build system

%:
	dh $@

override_dh_auto_configure:
	# No configuration needed for Zig build

override_dh_auto_build:
	# Build with Zig for release optimization
	zig build -Doptimize=ReleaseFast

override_dh_auto_test:
	# Run Zig tests
	zig build test

override_dh_auto_install:
	# Install binary to /usr/bin (binary name is nexcage)
	install -D -m 755 zig-out/bin/nexcage debian/nexcage/usr/bin/nexcage
	
	# Install configuration files
	install -D -m 644 packaging/config/config.json debian/nexcage/etc/nexcage/config.json.example || true
	install -D -m 644 packaging/config/proxmox-lxcri.json debian/nexcage/etc/nexcage/proxmox-lxcri.json.example || true
	
	# Install man page (if exists)
	install -D -m 644 packaging/man/proxmox-lxcri.1 debian/nexcage/usr/share/man/man1/nexcage.1 || true
	
	# Install documentation
	mkdir -p debian/nexcage/usr/share/doc/nexcage
	install -D -m 644 README.md debian/nexcage/usr/share/doc/nexcage/README.md
	[ -f docs/architecture.md ] && install -D -m 644 docs/architecture.md debian/nexcage/usr/share/doc/nexcage/architecture.md || true
	
	# Install bash completion
	install -D -m 644 packaging/completion/nexcage.bash debian/nexcage/usr/share/bash-completion/completions/nexcage 2>/dev/null || true

override_dh_auto_clean:
	# Clean build artifacts
	rm -rf zig-out/
	rm -rf zig-cache/

# Skip debug symbols extraction (Zig handles this differently)
override_dh_strip:

# Skip shared library dependencies analysis (static binary)
override_dh_shlibdeps:
